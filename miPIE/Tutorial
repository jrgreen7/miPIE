
Step 1 (Genome preparation):

Download the genome in 2bit format from: http://hgdownload.soe.ucsc.edu/goldenPath/dm6/bigZips/dm6.2bit. 
In order to convert the genome from 2bit format to fasta, download twoBitToFa from: 
hgdownload.cse.ucsc.edu/admin/exe/linux.x86_64/

Type the following commands in the terminal:
Sudo chmod +x ./twoBitToFa
./twoBitToFa dm6.2bit dme_genome.fa

The genome file must then be built into bowtie format:
Bowtie-build dme_genome.fa dme_genome


Step 2 (Experiment preparation):

Download the sra experiment from GEO or SRA databases:
ftp://ftp-trace.ncbi.nlm.nih.gov/sra/sra-instant/reads/ByExp/sra/SRX/SRX266/SRX266218/SRR827770/SRR827770.sra

Download the sratoolkit compatible with your system from:
https://www.ncbi.nlm.nih.gov/sra/docs/toolkitsoft/
The toolkit will be used to convert sra to fastq and fasta formats.

The sra file downloaded from SRA as read sequence can be converted to fasta format using the following command:
fastq-dump --fasta --accession SRR827770.sra

Next, run the fasta file through the white space remover script which is in the mirdeep2 directory using the following command:
Perl    remove_white_space_in_id.pl SRR827770.sra.fasta > SRR827770.fa



Step 3 (Using mirDeep2):

Install mirdeep2_0_0_7 from:
https://www.mdc-berlin.de/36381625/en/research/research_teams/systems_biology_of_gene_regulatory_elements/projects/miRDeep/older_miRDeep2_versions

Download and install miRDeep2 and all dependencies. See https://www.mdc-berlin.de/8551903/en/ for details on installing the miRDeep2 package.

Note: In case the install.pl file in the mirDeep2 folder ran into an error stating “ squid could not be downloaded”, replace address in line 230 of the file with : eddylab.org/software/squid/squid-1.9g.tar.gz 

Download and install the numpy (http://www.numpy.org/) and scikit-learn (http://scikit-learn.org/stable/) python packages.

Within your miRDeep2 installation, replace the miRDeep2.pl and mirdeep_core_algorithm.pl files with those provided in the miPIE package.

Run the mapper.pl script to map the reads against genome:
/mirdeep2_0_0_7/mapper.pl SRR827770.fa -c -j -k TGGAATTCTCGGGTGCCAAGGAACTCCAGTCAC -l 18 -m -p dme_genome -s SRR827770_collapsed.fa -t SRR827770_vs_genome.arf -v

Two files are required from miRbase to run mirDeep2, the stem-loop sequence and mature sequence for known mirnas. These files can be found at this link for dme:
http://mirbase.org/cgi-bin/mirna_summary.pl?org=dme

Choose the desired sequence set, click on select all and then click on fetch sequences on the bottom of the page. Copy each set of data into a separate fasta file.
Run each of the files through the white space remover script as done before.

Run the mirDeep2 script for predictions:
/mirdeep2_0_0_7/miRDeep2.pl SRR827770_collapsed.fa dme_genome.fa SRR827770_vs_genome.arf mature_mirna_dme.fa none precursor_mirna_dme.fa -t D.melanogaster -b -99


Step 4 (Using miPIE):

Run the predict.py python script from the base folder of the miPIE installation. The script requires one input, -d, which is the location of the output.mrd file generated by mirDeep2 in the last step of these instructions. A typical command line for this script is as follows:
python predict.py -d /home/user/dataset/mirdeep_runs/run_XX_XX_2015_t_XX_XX_XX

Prediction is performed using a pre-generated random forest model which was trained on five NGS data sets.

